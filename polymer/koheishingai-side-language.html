<link rel="import" href="/polymer/bower_components/polymer/polymer-element.html">
<link rel="import" href="/polymer/koheishingai-check-box.html">

<dom-module id="koheishingai-side-language">
  <template>
    <style>
      :host * {
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        -webkit-font-smoothing: antialiased;
      }
      :host h2 {
        margin: 0px;
        margin-bottom: 14px;
        color: rgba(0, 0, 0, 0.54);
        font-size: 14px;
        font-weight: 400;
        font-family: 'Roboto', sans-serif;
      }
      :host .selector {
        display: -webkit-box;
        display: -webkit-flex;
        display: -webkit-box;
        display: -moz-box;
        display: -webkit-flex;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-align: center;
        -webkit-align-items: center;
        -webkit-align-items: center;
        align-items: center;
        padding: 2px 0px 1px;
        border-bottom-width: 1px;
        border-bottom-style: solid;
        background-color: transparent;
        position: relative;
        -webkit-box-sizing: content-box;
        box-sizing: content-box;
        min-width: 64px;
        min-height: 26px;
        -webkit-box-flex: 1;
        -webkit-flex-grow: 1;
        -webkit-box-flex: 1;
        box-flex: 1;
        -webkit-flex-grow: 1;
        flex-grow: 1;
        border-bottom-color: rgba(0, 0, 0, 0.12);
        width: 100px;
        margin-left: 4px;
        margin-top: -7px;
        margin-bottom: 20px;
      }
      :host span.text {
        max-width: 100%;
        -webkit-box-flex: 1;
        flex: 1 1 auto;
        text-overflow: ellipsis;
        white-space: nowrap;
        overflow: hidden;
        padding-bottom: 1px;
        flex-shrink: 1;
      }
      :host span.text > div {
        display: inline;
        margin: 0;
        padding: 0;
        border: 0;
        vertical-align: baseline;
        font-size: 15px;
        font-weight: 300;
        color: #00a2df;
        cursor: pointer;
        font-family: 'Roboto', sans-serif;
      }
      :host span.text > div {
        text-transform: capitalize;
      }
      :host span.icon {
        display: block;
        -webkit-box-align: end;
        -webkit-align-items: flex-end;
        -webkit-align-items: flex-end;
        align-items: flex-end;
        text-align: end;
        height: 19px;
        margin: 0 4px;
        -webkit-transform: translate3d(0, -2px, 0);
        -webkit-transform: translate3d(0, -2px, 0);
        transform: translate3d(0, -2px, 0);
        font-size: 1.2rem;
        fill: #00a2df;
        cursor: pointer;
      }
      :host #menu {
        display: none;
        position: fixed;
        opacity: 1;
        -webkit-transform: translateY(31px);
        -webkit-transform: translateY(31px);
        transform: translateY(31px);
        -webkit-border-radius: 3px;
        border-radius: 3px;
        z-index: 120;
        min-width: 64px;
        min-height: 100px;
        width: 100px;
      }
      :host #menu > div {
        display: -webkit-box;
        display: -webkit-flex;
        display: -webkit-box;
        display: -moz-box;
        display: -webkit-flex;
        display: -ms-flexbox;
        display: flex;
        padding-top: 3px;
        padding-bottom: 3px;
        -webkit-box-orient: vertical;
        -webkit-box-direction: normal;
        -webkit-flex-direction: column;
        -webkit-flex-direction: column;
        flex-direction: column;
        -webkit-box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.2), 0 1px 1px 0 rgba(0, 0, 0, 0.14), 0 2px 1px -1px rgba(0, 0, 0, 0.12);
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.2), 0 1px 1px 0 rgba(0, 0, 0, 0.14), 0 2px 1px -1px rgba(0, 0, 0, 0.12);
        max-height: 256px;
        min-height: 48px;
        overflow-y: hidden;
        -webkit-transform-origin: left top;
        -webkit-transform-origin: left top;
        transform-origin: left top;
        -webkit-transform: scale(1);
        -webkit-transform: scale(1);
        transform: scale(1);
        background: #fff;
      }
      :host #menu > div > div {
        color: rgba(0, 0, 0, 0.54);
        cursor: pointer;
        position: relative;
        display: -webkit-box;
        display: -webkit-flex;
        display: -webkit-box;
        display: -moz-box;
        display: -webkit-flex;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-align: center;
        -webkit-align-items: center;
        -webkit-align-items: center;
        align-items: center;
        width: auto;
        padding: 0 16px 0 16px;
        height: 36px;
        font-family: 'Roboto', sans-serif;
        font-weight: 300;
        font-size: 15px;
        text-transform: capitalize;
      }
      @media only screen and (max-width: 840px) {  
      }
    </style>
    <section>
      <h2>Language</h2>
      <div class="selector" on-click="select">
        <span class="text">
          <div id="current-language"></div>
        </span>
        <span class="icon" aria-hidden="true">
          <svg height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg>
        </span>
        <div id="menu">
          <div id="language"></div>
        </div>
      </div>
    </section>
    <script>
      var sideLanguageTag = sidePanel.querySelector('koheishingai-side-language').shadowRoot;
      var sideLanguage = sideLanguageTag.getElementById("language");
      var currentLanguage = sideLanguageTag.getElementById("current-language");
      var database = firebase.database();
      var related = database.ref(location.pathname + "/side/language");
      related.on('value', function(snapshot) {
        var val = snapshot.val();
        for (i in val) {
          var data = val[i];
          var element = document.createElement("div");
          if (currentLanguage.innerText == "") {
            currentLanguage.innerText = data;
          }
          if (localStorage.language != "" && localStorage.language == data) {
            currentLanguage.innerText = localStorage.language;
          }
          element.classList.add('language');
          element.innerText = data;
          sideLanguage.appendChild(element);
        }
      });
      var body = document.body;
      var menu = sideLanguageTag.getElementById("menu");
      window.menuClicked = false;
      window.onclick = function(){
        window.clicked = true;
        if (window.clicked == window.menuClicked) {
          menu.style.display = "block";
          window.menuClicked = false;
        } else  {
          menu.style.display = "none";
        }
      }
    </script>
  </template>

  <script>
    /**
     * `koheishingai-side-language`
     * 
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class KoheishingaiSideLanguage extends Polymer.Element {
      static get is() { return 'koheishingai-side-language'; }
      select(e) {
        window.menuClicked = true;
        if (e.target.classList[0] == 'language') {
          localStorage.language = e.target.innerText.toLowerCase();
          currentLanguage.innerText = e.target.innerText.toLowerCase();
          setTimeout(function(){
            menu.style.display = "none";
          }, 150);
        }
      }
    }
    window.customElements.define(KoheishingaiSideLanguage.is, KoheishingaiSideLanguage);
  </script>
</dom-module>
